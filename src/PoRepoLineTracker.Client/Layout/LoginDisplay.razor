@using Microsoft.AspNetCore.Components.Authorization
@using PoRepoLineTracker.Client.Services
@inject ApiAuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
            @if (!string.IsNullOrEmpty(AuthStateProvider.CurrentUser?.AvatarUrl))
            {
                <RadzenImage Path="@AuthStateProvider.CurrentUser.AvatarUrl" 
                             Style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;" />
            }
            <RadzenText TextStyle="TextStyle.Body2" Style="color: var(--rz-text-color);">
                @(AuthStateProvider.CurrentUser?.DisplayName ?? AuthStateProvider.CurrentUser?.Username ?? "User")
            </RadzenText>
            <RadzenButton Text="Logout" 
                          ButtonStyle="ButtonStyle.Light" 
                          Variant="Variant.Outlined"
                          Size="ButtonSize.Small"
                          Click="@HandleLogout" />
        </RadzenStack>
    </Authorized>
    <NotAuthorized>
        <RadzenButton Text="Sign in with GitHub" 
                      Icon="login"
                      ButtonStyle="ButtonStyle.Primary"
                      Size="ButtonSize.Small"
                      Click="@HandleLogin" />
    </NotAuthorized>
</AuthorizeView>

@code {
    private void HandleLogin()
    {
        // Navigate to API login endpoint which will redirect to GitHub OAuth
        Navigation.NavigateTo("api/auth/login", forceLoad: true);
    }

    private void HandleLogout()
    {
        // Navigate to API logout endpoint
        Navigation.NavigateTo("api/auth/logout", forceLoad: true);
    }
}
