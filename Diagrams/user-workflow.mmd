flowchart TD
    %% User Entry Points
    Start([ðŸ‘¤ User Opens Application])
    
    %% Main Navigation
    Start --> Dashboard{ðŸ“Š Dashboard View}
    
    %% Add Repository Workflow
    Dashboard --> AddRepo[âž• Add Repository]
    AddRepo --> ValidateURL{ðŸ” Validate GitHub URL}
    ValidateURL -->|Valid| EnterURL[ðŸ“ Enter Repository URL]
    ValidateURL -->|Invalid| ShowError[âŒ Show Error Message]
    ShowError --> AddRepo
    
    EnterURL --> SubmitRepo[ðŸš€ Submit Repository]
    SubmitRepo --> Progress{â³ Track Progress}
    
    %% Progress States
    Progress --> Step1["ðŸ“‹ Step 1: Validating Repository 0-25%"]
    Step1 --> Step2["ðŸ’¾ Step 2: Adding to Database 25-50%"]
    Step2 --> Step3["ðŸ“¥ Step 3: Cloning Repository 50-75%"]
    Step3 --> Step4["ðŸ” Step 4: Analyzing Commits 75-100%"]
    Step4 --> AnalysisComplete[âœ… Analysis Complete!]
    
    %% Error Handling
    Step1 -->|Error| RepoError["âŒ Repository Not Found or Access Denied"]
    Step2 -->|Error| DatabaseError["âŒ Database Connection Error"]
    Step3 -->|Error| CloneError[âŒ Git Clone Failed]
    Step4 -->|Error| AnalysisError[âŒ Analysis Failed]
    
    RepoError --> AddRepo
    DatabaseError --> RetryOrContact[ðŸ”„ Retry or Contact Support]
    CloneError --> AddRepo
    AnalysisError --> RetryAnalysis[ðŸ”„ Retry Analysis Later]
    
    %% Success Flow
    AnalysisComplete --> RefreshList[ðŸ”„ Refresh Repository List]
    RefreshList --> ViewRepos[ðŸ“‹ View Repository List]
    
    %% Repository List Actions
    Dashboard --> ViewRepos
    ViewRepos --> RepoActions{ðŸŽ¯ Repository Actions}
    
    %% Individual Repository Actions
    RepoActions --> ViewChart[ðŸ“ˆ View Line Count Chart]
    RepoActions --> ViewCommits[ðŸ“ View Commit History]
    RepoActions --> ReanalyzePeriodic["ðŸ”„ Re-analyze Repository Background"]
    
    %% Chart Interactions
    ViewChart --> ChartOptions{ðŸ“Š Chart Options}
    ChartOptions --> ChangePeriod["ðŸ“… Change Time Period (7, 30, 90 days)"]
    ChartOptions --> ViewFileTypes[ðŸ—‚ï¸ View File Type Breakdown]
    ChartOptions --> DownloadData[ðŸ’¾ Download Chart Data]
    
    %% Chart Data Loading
    ChangePeriod --> LoadChart{â³ Loading Chart Data}
    LoadChart -->|Success| DisplayChart[ðŸ“ˆ Display Interactive Chart]
    LoadChart -->|Error| ChartError[âŒ Chart Data Error]
    ChartError --> ViewRepos
    
    %% Chart Features
    DisplayChart --> ChartInteractions{ðŸ–±ï¸ Chart Interactions}
    ChartInteractions --> ZoomChart[ðŸ” Zoom & Pan Timeline]
    ChartInteractions --> HoverDetails[â„¹ï¸ Hover for Details]
    ChartInteractions --> CompareRepos[âš–ï¸ Compare Multiple Repos]
    
    %% Multiple Repository Views
    ViewRepos --> AllChartsView[ðŸ“Š All Repositories Overview]
    AllChartsView --> BulkActions{ðŸŽ¯ Bulk Actions}
    BulkActions --> SelectTimeframe[ðŸ“… Select Common Timeframe]
    BulkActions --> ExportAllData[ðŸ“¤ Export All Data]
    BulkActions --> CompareSelected[âš–ï¸ Compare Selected Repos]
    
    %% Health & Diagnostics
    Dashboard --> HealthCheck[ðŸ¥ Health Diagnostics]
    HealthCheck --> CheckStatus{ðŸ” Check System Status}
    CheckStatus --> AzureStatus[â˜ï¸ Azure Storage Status]
    CheckStatus --> GitHubStatus[ðŸ“‚ GitHub API Status]
    CheckStatus --> AppStatus[âš™ï¸ Application Status]
    
    %% Status Results
    AzureStatus -->|Healthy| StatusOK[âœ… All Systems Operational]
    AzureStatus -->|Unhealthy| StorageIssue[âŒ Storage Connection Issue]
    GitHubStatus -->|Healthy| StatusOK
    GitHubStatus -->|Unhealthy| GitHubIssue[âŒ GitHub API Issue]
    AppStatus -->|Healthy| StatusOK
    AppStatus -->|Unhealthy| AppIssue[âŒ Application Issue]
    
    %% Error Resolution
    StorageIssue --> ContactSupport["ðŸ“ž Contact Support Check Azurite/Azure"]
    GitHubIssue --> CheckToken["ðŸ”‘ Check GitHub Token & Network"]
    AppIssue --> RestartApp[ðŸ”„ Restart Application]
    
    %% Settings & Configuration
    Dashboard --> Settings[âš™ï¸ Settings]
    Settings --> ViewFileExtensions[ðŸ—‚ï¸ View Tracked File Extensions]
    Settings --> ConfigureNotifications["ðŸ”” Configure Notifications (Future Feature)"]
    
    %% Return Flows
    ViewChart --> ViewRepos
    ViewCommits --> ViewRepos
    DisplayChart --> ViewRepos
    AllChartsView --> ViewRepos
    StatusOK --> Dashboard
    ContactSupport --> Dashboard
    CheckToken --> Dashboard
    RestartApp --> Dashboard
    ViewFileExtensions --> Dashboard
    RetryOrContact --> Dashboard
    RetryAnalysis --> ViewRepos
    
    %% Periodic Background Tasks (System)
    ReanalyzePeriodic -.->|Automatic| CheckForNewCommits[ðŸ” Check for New Commits]
    CheckForNewCommits -.->|If Found| Step3
    CheckForNewCommits -.->|None| WaitNextCheck[â° Wait for Next Check]
    WaitNextCheck -.-> ReanalyzePeriodic
    
    %% User Journey Loops
    RefreshList --> Dashboard
    CompareRepos --> ViewRepos
    ExportAllData --> ViewRepos
    CompareSelected --> AllChartsView
    DownloadData --> ViewChart
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef success fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
    classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
    classDef progress fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
    classDef interaction fill:#fafafa,stroke:#424242,stroke-width:1px,color:#000
    
    class Start,StatusOK startEnd
    class AddRepo,EnterURL,SubmitRepo,RefreshList,ViewRepos,ViewChart,ViewCommits,DisplayChart,AllChartsView,LoadChart,HealthCheck,Settings process
    class Dashboard,ValidateURL,Progress,RepoActions,ChartOptions,CheckStatus,BulkActions decision
    class AnalysisComplete,ExportAllData,DownloadData success
    class ShowError,RepoError,DatabaseError,CloneError,AnalysisError,ChartError,StorageIssue,GitHubIssue,AppIssue error
    class Step1,Step2,Step3,Step4,ChangePeriod,SelectTimeframe,CheckForNewCommits progress
    class ZoomChart,HoverDetails,CompareRepos,CompareSelected,ViewFileTypes,ViewFileExtensions,ConfigureNotifications interaction
